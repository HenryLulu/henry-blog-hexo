<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    
    
      
      
        
      
    
    <div class="bg-lines">
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
    </div>
    <nav class="nav from-post">
  <div class="bg"></div>
  <a class="nav-title" href="/">
    HEY!HENRY
  </a>
  <ul class="nav-links">
    <li>
      <a class="nav-link bold" href="/archives/">
        All articles
        <span class="nav-link-number">7</span>
      </a>
    </li>
    
      <li>
        <a class="nav-link" href="/tags/React/">
          React
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Basic/">
          Basic
          <span class="nav-link-number">
            1
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Server/">
          Server
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Cross-Platform/">
          Cross-Platform
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
  </ul>
  <a class="leave-btn" href="http://hong-yu.wang" target="_blank" rel="noopener">ABOUT ME</a>
</nav>

<nav class="nav-mobile">
  <div class="top-bar">
    <a class="logo" href="/" ></a>
    <ul class="btns">
      <li class="btn" data-type="tag">
        <p class="text">ARTICLES</p>
        <p class="icon icon-book"></p>
      </li>
    </ul>
  </div>
  <div class="list tag-list">
    <div></div>
    <div class="list-main">
      <ul>
        <li>
          <a class="link" href="/archives/">
            All articles
          </a>
        </li>
        
          <li>
            <a class="link" href="/tags/React/">
              React
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Basic/">
              Basic
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Server/">
              Server
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Cross-Platform/">
              Cross-Platform
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>
    <div class="body from-post">
      
  
    <div class="main">

  

<section class="menu">
  <header class="header">
    <h1 class="title">
      Server
      <span class="number">2</span>
    </h1>
  </header>
  <section class="list">
    
      <article class="item current">
        <a href="/从主页搭建看nginx常用配置/">
          <p class="item-info">2020-01-03 16:11</p>
          <p class="item-title">从主页搭建看nginx常用配置</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/【前端鉴权】session、cookie、token、jwt/">
          <p class="item-info">2020-01-03 18:15</p>
          <p class="item-title">【前端鉴权】session、cookie、token、jwt</p>
        </a>
      </article>
    
  </section>
</section>
  <section class="article">
  <p class="info">2020-01-03 16:11</p>
  <h1 class="title">从主页搭建看nginx常用配置</h1>
  <p class="summary"></p>
  <div class="main-content">
    <blockquote>
<p>在主页搭建过程中，借助Nginx方便实现静态资源、接口转发、子域名</p>
</blockquote>
<h2 id="nginx是什么？"><a href="#nginx是什么？" class="headerlink" title="nginx是什么？"></a>nginx是什么？</h2><p>nginx是个“HTTP服务器和反向代理服务器”。</p>
<h3 id="HTTP服务器怎么说？"><a href="#HTTP服务器怎么说？" class="headerlink" title="HTTP服务器怎么说？"></a>HTTP服务器怎么说？</h3><p>就像你去窗口办事，你说你要办什么，然后递上你的材料，窗口小姐姐一顿操作后给你返回材料。这期间她可能复印了你的材料、在系统里录入你的信息、盖章、填表、点钱，但返回给你的，一定是一个明确的办理结果（给你个证、告诉你材料不够、告诉你今天下班了）。这次办理请求就算完成了。<br>nginx就像这个窗口小姐姐，它能处理你的HTTP请求，比如把服务器上的静态资源返给你。</p>
<h3 id="反向代理怎么说？"><a href="#反向代理怎么说？" class="headerlink" title="反向代理怎么说？"></a>反向代理怎么说？</h3><p>有些事，窗口小姐姐办不了。比如你去取个文件，她不能自己起来去找啊，就喊后面小哥找，把你的请求代理给小哥处理，找到文件后，再经她手返给你。这期间，你不用关心小哥是谁，怎么找到的文件，只管拿走文件。这就叫反向代理。<br>如果有好几个小哥负责找文件，小姐姐会挑一个闲着的，这就是反向代理的一个重要用途：负载均衡。</p>
<h2 id="回到项目需求"><a href="#回到项目需求" class="headerlink" title="回到项目需求"></a>回到项目需求</h2><p>我的项目是个基于React开发的主页，现在手里有一台ubuntu服务器，想把主页放上去。</p>
<h3 id="安装并启动nginx"><a href="#安装并启动nginx" class="headerlink" title="安装并启动nginx"></a>安装并启动nginx</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><code class="hljs kotlin">sudo apt-<span class="hljs-keyword">get</span> install nginx<br>sudo /etc/<span class="hljs-keyword">init</span>.d/nginx start<br></code></pre></td></tr></table></figure>
<h3 id="需求一：直接访问React编译产出的静态文件"><a href="#需求一：直接访问React编译产出的静态文件" class="headerlink" title="需求一：直接访问React编译产出的静态文件"></a>需求一：直接访问React编译产出的静态文件</h3><p>最初的主页就是个静态页面，起一个node服务有点多余了，如何配nginx快速访问React呢？</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;    <span class="hljs-comment"># nginx监听端口</span><br>    <span class="hljs-attribute">server_name</span> _;    <span class="hljs-comment"># 匹配名</span><br>    <span class="hljs-attribute">location</span> / &#123;<br>        <span class="hljs-attribute">root</span> /root/react/build;   <span class="hljs-comment"># 静态资源路径</span><br>        <span class="hljs-attribute">index</span> index.html;    <span class="hljs-comment">#index</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>server：http服务器配置</li>
<li>listen：监听的端口</li>
<li>server_name：服务器名</li>
<li>location：匹配请求路径</li>
<li>root：静态资源目录</li>
</ul>
<p>配好后，重载配置<br>sudo nginx -s reload</p>
<h3 id="需求二：代理请求"><a href="#需求二：代理请求" class="headerlink" title="需求二：代理请求"></a>需求二：代理请求</h3><p>后来想加个功能，就是从github把我的库列表拉过来放到主页里展示。<br>这里需要github的api，以后细说，总之是个需要身份认证的接口。<br>如果我直接在前端请求，有两个问题：1是跨域；2是身份认证肯定要暴露了，所以需要请求我自己的服务器，再代理到github api。<br>这次只关注location，在 / 下面新增一条就好。</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli">location / &#123;<br>    ……<br>&#125;<br>location <span class="hljs-string">/api/github</span> &#123;<br>    rewrite ^<span class="hljs-string">/api/github/</span><span class="hljs-params">(.*)</span>$ /$1 break;    <span class="hljs-comment"># 把路由中的/api/github去掉</span><br>    proxy_pass https:<span class="hljs-string">//api.github.com</span>;    <span class="hljs-comment"># 代理到github api</span><br>    proxy_<span class="hljs-keyword">set</span>_header Authorization xxx;    <span class="hljs-comment"># 添加token header（解除github api调用次数限制）</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>rewrite：重写请求路径</li>
<li>proxy_pass：代理地址</li>
<li>proxy_set_header：设置header</li>
</ul>
<h2 id="需求三：子域名"><a href="#需求三：子域名" class="headerlink" title="需求三：子域名"></a>需求三：子域名</h2><p>一个主页已经不能满足我的网站了，我想让home.xxx.com指向主页，blog.xxx.com指向另外一个站点。<br>只需要修改server_name匹配：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">server_name</span> <span class="hljs-selector-tag">home</span><span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.com</span>;<br></code></pre></td></tr></table></figure>
<p>对blog，再新建一个server：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span><br>&#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;    <span class="hljs-comment"># nginx监听端口</span><br>    <span class="hljs-attribute">server_name</span> blog.xxx.com;<br>    <span class="hljs-attribute">location</span> / &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
  </div>
</section>

  




    </div>
  </div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="/js/script.js"></script>

</html>
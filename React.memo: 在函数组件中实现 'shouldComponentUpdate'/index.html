<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    
    
      
      
        
      
    
    <div class="bg-lines">
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
    </div>
    <nav class="nav from-post">
  <div class="bg"></div>
  <a class="nav-title" href="/">
    HEY!HENRY
  </a>
  <ul class="nav-links">
    <li>
      <a class="nav-link bold" href="/archives/">
        All articles
        <span class="nav-link-number">7</span>
      </a>
    </li>
    
      <li>
        <a class="nav-link" href="/tags/React/">
          React
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Basic/">
          Basic
          <span class="nav-link-number">
            1
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Server/">
          Server
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Cross-Platform/">
          Cross-Platform
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
  </ul>
  <a class="leave-btn" href="http://hong-yu.wang" target="_blank" rel="noopener">ABOUT ME</a>
</nav>

<nav class="nav-mobile">
  <div class="top-bar">
    <a class="logo" href="/" ></a>
    <ul class="btns">
      <li class="btn" data-type="tag">
        <p class="text">ARTICLES</p>
        <p class="icon icon-book"></p>
      </li>
    </ul>
  </div>
  <div class="list tag-list">
    <div></div>
    <div class="list-main">
      <ul>
        <li>
          <a class="link" href="/archives/">
            All articles
          </a>
        </li>
        
          <li>
            <a class="link" href="/tags/React/">
              React
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Basic/">
              Basic
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Server/">
              Server
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Cross-Platform/">
              Cross-Platform
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>
    <div class="body from-post">
      
  
    <div class="main">

  

<section class="menu">
  <header class="header">
    <h1 class="title">
      React
      <span class="number">2</span>
    </h1>
  </header>
  <section class="list">
    
      <article class="item ">
        <a href="/React中Latex公式展现/">
          <p class="item-info">2020-01-03 18:01</p>
          <p class="item-title">React中Latex公式展现</p>
        </a>
      </article>
    
      <article class="item current">
        <a href="/React.memo: 在函数组件中实现 &#39;shouldComponentUpdate&#39;/">
          <p class="item-info">2019-12-31 16:54</p>
          <p class="item-title">React.memo: 在函数组件中实现 &#39;shouldComponentUpdate&#39;</p>
        </a>
      </article>
    
  </section>
</section>
  <section class="article">
  <p class="info">2019-12-31 16:54</p>
  <h1 class="title">React.memo: 在函数组件中实现 &#39;shouldComponentUpdate&#39;</h1>
  <p class="summary"></p>
  <div class="main-content">
    <h4 id="需要优化的场景"><a href="#需要优化的场景" class="headerlink" title="需要优化的场景"></a>需要优化的场景</h4><p>在Hooks为主的React项目中，会有大量的组件通过函数声明。多数情况下，我们不需要对函数组件的渲染进行特殊优化，即使有些重复渲染因不会对体验造成太大影响也被忽略了。<br>但有些情况下优化就显得很必要，比如如下场景：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> DemoLoader = <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; demoUrl &#125; = props;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"demoloader"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;demoUrl&#125;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>;<br>&#125;;</span><br></code></pre></td></tr></table></figure>
<p>这里声明了一个函数组件，组件很简单，接受<code>demoUrl props</code>，并作为<code>iframe</code>的<code>src</code>渲染出来。如果这里做了不必要的rerender，<code>iframe</code>就会重新加载，一方面出现白屏，另一方面对服务器增加了一次请求压力。</p>
<h4 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h4><p>在class组件中，我们可以通过<code>shouldComponentUpdate</code>阻止不必要的rerender：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>&#123;<br><br>  shouldComponentUpdate(nextProps) &#123;<br>    <span class="hljs-keyword">return</span> nextProps.demoUrl !== <span class="hljs-keyword">this</span>.props.demoUrl;<br>  &#125;<br><br>  render() &#123;<br>    <span class="hljs-keyword">const</span> &#123; domoUrl &#125; = <span class="hljs-keyword">this</span>.props;<br>    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"demoloader"</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;demoUrl&#125;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>;<br>  &#125;<br>&#125;</span><br></code></pre></td></tr></table></figure>
<p>但在函数组件中，没有<code>shouldComponentUpdate</code></p>
<h4 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo"></a>React.memo</h4><p>为了解决函数组件中的优化问题，React在<code>16.6</code>版本增加了<code>React.memo</code>。官网文档：<a href="https://reactjs.org/docs/react-api.html#reactmemo" target="_blank" rel="noopener">https://reactjs.org/docs/react-api.html#reactmemo</a>    </p>
<blockquote>
<p><code>React.memo</code>是一个高阶组件，类似于<code>React.PureComponent</code>，只不过用于函数组件而非class组件。<br>如果你的函数组件在相同<code>props</code>下渲染出相同结果，你可以把它包裹在<code>React.memo</code>中来通过缓存渲染结果来实现性能优化。这意味着<code>React</code>会跳过组件渲染，而使用上次渲染结果。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> MyComponent = React.memo(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyComponent</span>(<span class="hljs-params">props</span>) </span>&#123;<br>  <span class="hljs-comment">/* render using props */</span><br>&#125;);<br></code></pre></td></tr></table></figure>
<blockquote>
<p><code>React.memo</code>默认只会浅比较<code>props</code>，如果需要定制比较，你可以给第二个参数传入自定义比较函数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyComponent</span>(<span class="hljs-params">props</span>) </span>&#123;<br>  <span class="hljs-comment">/* render using props */</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">areEqual</span>(<span class="hljs-params">prevProps, nextProps</span>) </span>&#123;<br>  <span class="hljs-comment">/*<br>  return true if passing nextProps to render would return<br>  the same result as passing prevProps to render,<br>  otherwise return false<br>  */</span><br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> React.memo(MyComponent, areEqual);<br></code></pre></td></tr></table></figure>
<blockquote>
<p>和class组件中的<code>shouldComponentUpdate</code>不同，如果<code>props</code>相同则应返回<code>true</code>，否则返回<code>false</code>。这点二者正好相反。</p>
</blockquote>
<h4 id="改写组件"><a href="#改写组件" class="headerlink" title="改写组件"></a>改写组件</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> DemoLoader = React.memo(<span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; demoUrl &#125; = props;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"demoloader"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;demoUrl&#125;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>;<br>&#125;, (prevProps, nextProps) =&gt; &#123;<br>  return prevProps.demoUrl === nextProps.demoUrl;<br>&#125;);</span><br></code></pre></td></tr></table></figure>
  </div>
</section>

  




    </div>
  </div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="/js/script.js"></script>

</html>
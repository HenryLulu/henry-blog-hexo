<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    
    
      
      
        
      
    
    <div class="bg-lines">
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
      <div class="bg-lines-item"></div>
    </div>
    <nav class="nav from-archives">
  <div class="bg"></div>
  <a class="nav-title" href="/">
    HEY!HENRY
  </a>
  <ul class="nav-links">
    <li>
      <a class="nav-link bold" href="/archives/">
        All articles
        <span class="nav-link-number">7</span>
      </a>
    </li>
    
      <li>
        <a class="nav-link" href="/tags/React/">
          React
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Basic/">
          Basic
          <span class="nav-link-number">
            1
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Server/">
          Server
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
      <li>
        <a class="nav-link" href="/tags/Cross-Platform/">
          Cross-Platform
          <span class="nav-link-number">
            2
          </span>
        </a>
      </li>
    
  </ul>
  <a class="leave-btn" href="http://hong-yu.wang" target="_blank" rel="noopener">ABOUT ME</a>
</nav>

<nav class="nav-mobile">
  <div class="top-bar">
    <a class="logo" href="/" ></a>
    <ul class="btns">
      <li class="btn" data-type="tag">
        <p class="text">ARTICLES</p>
        <p class="icon icon-book"></p>
      </li>
    </ul>
  </div>
  <div class="list tag-list">
    <div></div>
    <div class="list-main">
      <ul>
        <li>
          <a class="link" href="/archives/">
            All articles
          </a>
        </li>
        
          <li>
            <a class="link" href="/tags/React/">
              React
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Basic/">
              Basic
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Server/">
              Server
            </a>
          </li>
        
          <li>
            <a class="link" href="/tags/Cross-Platform/">
              Cross-Platform
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>
    <div class="body from-archives">
      <div class="main">

  
  
    

<section class="menu">
  <header class="header">
    <h1 class="title">
      All articles
      <span class="number">7</span>
    </h1>
  </header>
  <section class="list">
    
      <article class="item current">
        <a href="/React中Latex公式展现/">
          <p class="item-info">2020-01-03 18:01</p>
          <p class="item-title">React中Latex公式展现</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/CORS原理及配置/">
          <p class="item-info">2020-01-03 16:27</p>
          <p class="item-title">CORS原理及配置</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/React.memo: 在函数组件中实现 &#39;shouldComponentUpdate&#39;/">
          <p class="item-info">2019-12-31 16:54</p>
          <p class="item-title">React.memo: 在函数组件中实现 &#39;shouldComponentUpdate&#39;</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/从主页搭建看nginx常用配置/">
          <p class="item-info">2020-01-03 16:11</p>
          <p class="item-title">从主页搭建看nginx常用配置</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/跨端方案/">
          <p class="item-info">2019-12-16 15:32</p>
          <p class="item-title">跨端方案</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/【前端鉴权】session、cookie、token、jwt/">
          <p class="item-info">2020-01-03 18:15</p>
          <p class="item-title">【前端鉴权】session、cookie、token、jwt</p>
        </a>
      </article>
    
      <article class="item ">
        <a href="/智慧课堂Flutter应用分享/">
          <p class="item-info">2020-01-03 17:37</p>
          <p class="item-title">智慧课堂Flutter应用分享</p>
        </a>
      </article>
    
  </section>
</section>
    <section class="article">
  <p class="info">2020-01-03 18:01</p>
  <h1 class="title">React中Latex公式展现</h1>
  <p class="summary"></p>
  <div class="main-content">
    <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近在做一个题库产品，需要把公式展现到前端React中，如下：<br><img src="http://static.chiyuanyuan.com/9ekmbP.jpg" alt=""><br>方案是后端返回Latex格式，前端解析展现，相比用图片，有几点好处：</p>
<ul>
<li>公式清晰</li>
<li>可复制</li>
<li>减少前端图片资源请求和后端资源存储</li>
</ul>
<h2 id="LaTex公式"><a href="#LaTex公式" class="headerlink" title="LaTex公式"></a>LaTex公式</h2><h3 id="什么是LaTex？"><a href="#什么是LaTex？" class="headerlink" title="什么是LaTex？"></a>什么是LaTex？</h3><p>写过论文的应该都知道，LaTex是一套排版语法，通过LaTex编码可以展现复杂的排版格式，包括公式。</p>
<h3 id="公式相关语法"><a href="#公式相关语法" class="headerlink" title="公式相关语法"></a>公式相关语法</h3><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>一个Latex公式示例如下：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><code class="hljs tex"><span class="hljs-tag">\<span class="hljs-name">mathrm</span><span class="hljs-string">&#123;y&#125;</span>=</span><span class="hljs-tag">\<span class="hljs-name">mathrm</span><span class="hljs-string">&#123;lg&#125;</span></span><span class="hljs-tag">\<span class="hljs-name">frac</span><span class="hljs-string">&#123;x&#125;</span><span class="hljs-string">&#123;x-2&#125;</span></span>+<span class="hljs-tag">\<span class="hljs-name">mathit</span><span class="hljs-string">&#123;arcsin&#125;</span></span><span class="hljs-tag">\<span class="hljs-name">frac</span><span class="hljs-string">&#123;x&#125;</span><span class="hljs-string">&#123;3&#125;</span></span><br></code></pre></td></tr></table></figure>
<p>其中\xxx就是LaTex控制字符，{x}是字符参数，比如这里\frac{x}{x-2}表示x为分子，x-2为分母的分数</p>
<h4 id="常见语法"><a href="#常见语法" class="headerlink" title="常见语法"></a>常见语法</h4><p><a href="https://blog.csdn.net/garfielder007/article/details/51646604" target="_blank" rel="noopener">https://blog.csdn.net/garfielder007/article/details/51646604</a></p>
<h2 id="MathJax"><a href="#MathJax" class="headerlink" title="MathJax"></a>MathJax</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>MathJax是一款运行在浏览器中的开源数学符号渲染引擎，使用MathJax可以方便的在浏览器中显示数学公式，不需要使用图片。目前，MathJax可以解析Latex、MathML和ASCIIMathML的标记语言。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/x-mathjax-config"</span>&gt;</span><span class="actionscript"><br>  MathJax.Hub.Config(&#123;tex2jax: &#123;inlineMath: [[<span class="hljs-string">'$'</span>,<span class="hljs-string">'$'</span>], [<span class="hljs-string">'\\('</span>,<span class="hljs-string">'\\)'</span>]]&#125;&#125;);<br></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span><br>  <span class="hljs-attr">src</span>=<span class="hljs-string">"http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="React下的MathJax"><a href="#React下的MathJax" class="headerlink" title="React下的MathJax"></a>React下的MathJax</h2><h3 id="直接用MathJax的注意点"><a href="#直接用MathJax的注意点" class="headerlink" title="直接用MathJax的注意点"></a>直接用MathJax的注意点</h3><p>React组件是动态的，需要在每次did时都配置下激活，代码变成这样</p>
<figure class="highlight less"><table><tr><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">constructor</span> (props) &#123;<br>  <span class="hljs-selector-tag">super</span>(props);<br>  <span class="hljs-selector-tag">MathJax</span><span class="hljs-selector-class">.Hub</span><span class="hljs-selector-class">.Config</span>(&#123; <span class="hljs-attribute">tex2jax</span>: &#123;<span class="hljs-attribute">inlineMath</span>: [[<span class="hljs-string">'$'</span>,<span class="hljs-string">'$'</span>], [<span class="hljs-string">'\\('</span>,<span class="hljs-string">'\\)'</span>]]&#125; &#125;);<br>&#125;<br><span class="hljs-selector-tag">componentDidMount</span> () &#123;<br>  <span class="hljs-selector-tag">MathJax</span><span class="hljs-selector-class">.Hub</span><span class="hljs-selector-class">.Queue</span>([<span class="hljs-string">"Typeset"</span>, MathJax.Hub, document.querySelector(<span class="hljs-string">'.challenge__description'</span>)]);<br>&#125;<br><span class="hljs-selector-tag">componentDidUpdate</span> () &#123;<br>  <span class="hljs-selector-tag">MathJax</span><span class="hljs-selector-class">.Hub</span><span class="hljs-selector-class">.Queue</span>([<span class="hljs-string">"Typeset"</span>, MathJax.Hub, document.querySelector(<span class="hljs-string">'.challenge__description'</span>)]);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="react-mathjax"><a href="#react-mathjax" class="headerlink" title="react-mathjax"></a>react-mathjax</h3><p>一个封装好的react下mathjax组件：<a href="https://www.npmjs.com/package/react-mathjax" target="_blank" rel="noopener">https://www.npmjs.com/package/react-mathjax</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">MathJax.Provider</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">MathJax.Node</span> <span class="hljs-attr">formula</span>=<span class="hljs-string">&#123;tex&#125;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">MathJax.Provider</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="基于react-mathjax封装一个组件"><a href="#基于react-mathjax封装一个组件" class="headerlink" title="基于react-mathjax封装一个组件"></a>基于react-mathjax封装一个组件</h2><h3 id="为什么要封装一层"><a href="#为什么要封装一层" class="headerlink" title="为什么要封装一层"></a>为什么要封装一层</h3><p>react-mathjax要求直接向Node传入标准LaTex，但在项目中，LaTex片段是以这种形式插入到返回数据中的：</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><code class="hljs dust"><span class="xml">函数$ \\mathrm</span><span class="hljs-template-variable">&#123;y&#125;</span><span class="xml">=\\mathrm</span><span class="hljs-template-variable">&#123;lg&#125;</span><span class="xml">\\frac</span><span class="hljs-template-variable">&#123;x&#125;</span><span class="hljs-template-variable">&#123;x-2&#125;</span><span class="xml">+\\mathit</span><span class="hljs-template-variable">&#123;arcsin&#125;</span><span class="xml">\\frac</span><span class="hljs-template-variable">&#123;x&#125;</span><span class="hljs-template-variable">&#123;3&#125;</span><span class="xml">$ 的定义域是_______。</span><br></code></pre></td></tr></table></figure>
<p>我们需要这样一个组件，即传入夹杂着LaTex的字符串，render一个包含正常文本和MathJax节点的元素。</p>
<h3 id="Latex语法匹配和替换"><a href="#Latex语法匹配和替换" class="headerlink" title="Latex语法匹配和替换"></a>Latex语法匹配和替换</h3><p>这里最关键的是Latex语法匹配和替换，代码如下：</p>
<figure class="highlight flix"><table><tr><td class="code"><pre><code class="hljs flix">const reg = /(\$[^\$]+\$)/g;<br><span class="hljs-keyword">let</span> <span class="hljs-keyword">match</span>;<br><span class="hljs-keyword">let</span> lastIndex = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">let</span> nodes = [];<br>while (<span class="hljs-keyword">match</span> = reg.exec(str)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">match</span>.<span class="hljs-keyword">index</span> !== lastIndex) &#123;<br>        nodes.push(str.slice(lastIndex, <span class="hljs-keyword">match</span>.<span class="hljs-keyword">index</span>));<br>    &#125;<br>    nodes.push(&lt;span&gt;<br>        &lt;MathJax.Node inline formula=&#123;str.slice(<span class="hljs-keyword">match</span>.<span class="hljs-keyword">index</span> + <span class="hljs-number">1</span>, <span class="hljs-keyword">match</span>.<span class="hljs-keyword">index</span> + <span class="hljs-keyword">match</span>[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>)&#125; /&gt;<br>    &lt;/span&gt;);<br>    lastIndex = <span class="hljs-keyword">match</span>.<span class="hljs-keyword">index</span> + <span class="hljs-keyword">match</span>[<span class="hljs-number">0</span>].length;<br>&#125;<br><span class="hljs-keyword">if</span> (lastIndex !== str.length) &#123;<br>    nodes.push(str.slice(lastIndex));<br>&#125;<br>return &lt;MathJax.Provider&gt;&#123;nodes&#125;&lt;/MathJax.Provider&gt;;<br></code></pre></td></tr></table></figure>
<h3 id="调用和结果"><a href="#调用和结果" class="headerlink" title="调用和结果"></a>调用和结果</h3><figure class="highlight dust"><table><tr><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MathJaxRenderer</span> <span class="hljs-attr">source</span>=</span></span><span class="hljs-template-variable">&#123;'函数$ \\mathrm&#123;y&#125;</span><span class="xml"><span class="hljs-tag">=<span class="hljs-string">\\mathrm</span></span></span><span class="hljs-template-variable">&#123;lg&#125;</span><span class="xml"><span class="hljs-tag">\\<span class="hljs-attr">frac</span></span></span><span class="hljs-template-variable">&#123;x&#125;</span><span class="xml"><span class="hljs-tag"></span></span><span class="hljs-template-variable">&#123;x-2&#125;</span><span class="xml"><span class="hljs-tag">+\\<span class="hljs-attr">mathit</span></span></span><span class="hljs-template-variable">&#123;arcsin&#125;</span><span class="xml"><span class="hljs-tag">\\<span class="hljs-attr">frac</span></span></span><span class="hljs-template-variable">&#123;x&#125;</span><span class="xml"><span class="hljs-tag"></span></span><span class="hljs-template-variable">&#123;3&#125;</span><span class="xml"><span class="hljs-tag">$ 的定义域是<span class="hljs-attr">_______</span>。'&#125; /&gt;</span></span><br></code></pre></td></tr></table></figure>

  </div>
</section>
  


    </div>
  </div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="/js/script.js"></script>

</html>